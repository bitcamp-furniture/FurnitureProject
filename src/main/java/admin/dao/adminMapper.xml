<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="adminSQL">
 	<!-- 회원목록 -->
	<select id="getMemberList" parameterType="java.util.Map" resultType="member">
 		select * from(select rownum rn, tt.* from
 				(select * from member order by created_at desc)tt)
 				         where <![CDATA[rn>= #{startNum}]]> and  <![CDATA[rn<= #{endNum}]]>   
 	</select>
 
 	<!-- 총 글 수 -->
	<select id="getTotalA" resultType="int">
		select count(*) from member
	</select>
	
	<!-- 검색 -->
	<select id="getSearchMemberList" parameterType="java.util.Map" resultType="member">
         select * from(select rownum rn, tt. * from
          (select * from member where (name || email) like '%'||#{keyword}||'%' order by created_at desc)tt) 
          where <![CDATA[rn >= #{startNum}]]> and <![CDATA[rn <= #{endNum}]]>
    </select>
    
    <!-- 검색 총 글 수 -->
    <select id="getSearchTotal" parameterType="java.util.Map" resultType="int">
      select count(*) from member where (name || email) like '%'||#{keyword}||'%'
    </select>
    
    <!-- 회원삭제 -->
	<delete id="memberListDelete" parameterType="java.util.Map">
		delete member where id in
		<foreach collection="array" item="item" open="(" close=")" separator=",">
			#{item}
		</foreach>
	</delete>

	<select id="reviewList" parameterType="java.util.Map" resultType="review">
		select * from 
		(select rownum rn, tt.* from 
		(select * from REVIEW order by id)tt
		)where rn &gt;= #{startNum} and rn &lt;= #{endNum}
	</select>
	
	<!-- 모든 리스트 개수  -->
	<select id="getTotalReviewList" resultType="int">
		select count(*) from REVIEW
	</select>
	
	<!-- 선택 리뷰 삭제 -->
	<delete id="adminReviewListDelete" parameterType="java.util.Map">
		delete REVIEW where id in
		<foreach collection="array" item="item" open="(" close=")" separator=",">
			#{item}
			<!--${array[i]}  -->
		</foreach>
	</delete>
	
	<!-- sort1 오름차순-->
	<select id="adminreviewASCList" parameterType="java.util.Map" resultType="review">
	<![CDATA[
		select * from 
		(select rownum rn, tt.* from 
		(select * from REVIEW order by ${sort1} asc)tt
		)where rn >= #{startNum} and rn <= #{endNum}
		]]>
	</select>
	
	<!-- sort1 내림차순-->
	<select id="adminreviewDESCList" parameterType="java.util.Map" resultType="review">
	<![CDATA[
		select * from 
		(select rownum rn, tt.* from 
		(select * from REVIEW order by ${sort1} desc)tt
		)where rn >= #{startNum} and rn <= #{endNum}
		]]>
	</select>
	
	<!-- 대시보드 ... 최신 리뷰 리스트 -->
	<select id="getRecentReviewList" resultType="review">
	<![CDATA[
		select * from (
			select * from review order by created_at desc
		) where rownum <= 3
	]]>
	</select>

	<!-- 대시보드 ... 최신 문의 리스트 -->
	<select id="getRecentQnAList" resultType="ask">
	<![CDATA[
		select * from (
			select * from ask order by created_at desc
		) where rownum <= 5
	]]>
	</select>
	
	<!-- 주문내역 띄우기 -->
 	<select id="getOrderControl" parameterType="java.util.Map" resultType="adminProduct">
		select distinct o.order_number,
					o.order_date,
					p.product_name,
					od.product_color,
					od.product_qty,
					o.total_amount,
					od.order_status,
	                o.member_id,
	                od.id
				 from orders o
					  inner join orders_detail od
								 on o.order_number=od.order_number
					  Inner join product p
								 on od.product_id=p.id

	</select>
	
	<!-- 배송준비 버튼 클릭 했을 때 -->
	<update id="deliveryReady" parameterType="java.util.Map">
		update orders_detail set order_status = '배송준비' where id in
		<foreach collection="array" item="item" open="(" close=")" separator=",">
			#{item}
		</foreach>
	</update>
	
	<!-- 입금확인 버튼 클릭 시 -->
	<update id="paymentConfirm" parameterType="java.util.Map">
		update orders_detail set order_status = '입금확인' where id in
		<foreach collection="array" item="item" open="(" close=")" separator=",">
			#{item}
		</foreach>
	</update>
	
	<!-- 배송중 버튼 클릭 시 -->
	<update id="delivery" parameterType="java.util.Map">
		update orders_detail set order_status = '배송중' where id in
		<foreach collection="array" item="item" open="(" close=")" separator=",">
			#{item}
		</foreach>
	</update>
	
	<!-- 발송지연 -->
	<update id="delay" parameterType="java.util.Map">
		update orders_detail set order_status = '발송지연중' where id in
		<foreach collection="array" item="item" open="(" close=")" separator=",">
			#{item}
		</foreach>
	</update>
	
	<!-- 주문취소 --> <!-- order_number로 삭제시켜야함 (추후 수정) orders, order_detail 삭제 -->
	<delete id="cancelSales" parameterType="java.util.Map">
		delete orders_detail where id in
		<foreach collection="array" item="item" open="(" close=")" separator=",">
			#{item}
		</foreach>
	</delete>
	
	<!-- 주문검색 -->
	<select id="getSearchOrderList" parameterType="java.util.Map" resultType="adminProduct">
         select * from(select rownum rn, tt. * from
          (select * from orders where order_number like '%'||#{keyword}||'%' order by order_date desc)tt) 
          where <![CDATA[rn >= #{startNum}]]> and <![CDATA[rn <= #{endNum}]]>
    </select>
	
</mapper>
